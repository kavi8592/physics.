<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A/L Physics AI Tutor - Sri Lanka</title>
    <style>
        :root {
            --primary: #1e3a8a; /* Deep Academic Blue */
            --secondary: #f59e0b; /* Gold */
            --accent: #3b82f6;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
            --border: #cbd5e1;
            --success: #10b981;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), #0f172a);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* Main Container */
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            width: 100%;
            flex: 1;
        }

        /* Input Section */
        .input-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .lang-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
            justify-content: center;
        }

        .lang-btn {
            padding: 8px 20px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1rem;
        }

        textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid var(--border);
            border-radius: 12px;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .hint {
            font-size: 0.875rem;
            color: #64748b;
            margin-top: 0.5rem;
        }

        /* Solve Button */
        .solve-btn {
            width: 100%;
            padding: 1rem;
            margin-top: 1.5rem;
            background: linear-gradient(135deg, var(--secondary), #d97706);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .solve-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(245, 158, 11, 0.3);
        }

        .solve-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Results Section */
        .result-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            display: none;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--bg);
        }

        .result-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .language-tag {
            background: var(--bg);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
        }

        .solution-content {
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .solution-content h3 {
            color: var(--primary);
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.2rem;
        }

        .solution-content p {
            margin-bottom: 1rem;
        }

        .final-answer-box {
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
            border: 2px solid var(--success);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            text-align: center;
        }

        .final-answer-label {
            font-size: 0.875rem;
            color: #065f46;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .final-answer-value {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .error-box {
            background: #fee2e2;
            border: 2px solid #ef4444;
            color: #991b1b;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: #64748b;
            font-size: 0.875rem;
            border-top: 1px solid var(--border);
            margin-top: 2rem;
        }

        /* Responsive */
        @media (max-width: 640px) {
            header h1 { font-size: 1.5rem; }
            .input-card, .result-card { padding: 1.5rem; }
        }
    </style>
</head>
<body>

    <header>
        <h1>üéì A/L Physics AI Tutor</h1>
        <div class="subtitle">Sri Lankan G.C.E. Advanced Level Physics Assistant</div>
        <div class="subtitle" style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">
            ‡∂ã‡∑É‡∑É‡∑ä ‡∂¥‡∑ô‡∑Ö ‡∂∑‡∑û‡∂≠‡∑í‡∂ö ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è AI ‡∂ã‡∂¥‡∂Ø‡∑ö‡∑Å‡∂ö
        </div>
    </header>

    <div class="container">
        
        <!-- Input Section -->
        <div class="input-card">
            <div class="lang-selector">
                <button class="lang-btn active" onclick="setLang('en')" id="btn-en">English</button>
                <button class="lang-btn" onclick="setLang('si')" id="btn-si">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</button>
                <button class="lang-btn" onclick="setLang('both')" id="btn-both">English + ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</button>
            </div>

            <label for="questionInput">
                <span id="label-text">Enter your Physics Problem:</span>
            </label>
            
            <textarea 
                id="questionInput" 
                placeholder="Example: A car starts from rest and accelerates at 2 m/s¬≤ for 10 seconds. Find the final velocity.&#10;&#10;‡∂ã‡∂Ø‡∑è‡∑Ñ‡∂ª‡∂´‡∂∫: ‡∂∏‡∑ù‡∂ß‡∂ª‡∑ä ‡∂ª‡∂Æ‡∂∫‡∂ö‡∑ä ‡∑Ä‡∑í‡∑Ä‡∑ö‡∂ö‡∂∫‡∑ô‡∂±‡∑ä ‡∂Ü‡∂ª‡∂∏‡∑ä‡∂∑ ‡∑Ä‡∑ì ‡∂≠‡∂≠‡∑ä‡∂¥‡∂ª 10 ‡∂ö‡∑ä ‡∂≠‡∑î‡∑Ö‡∂Ø‡∑ì 2 m/s¬≤ ‡∂≠‡∑ä‡∑Ä‡∂ª‡∂´‡∂∫‡∂ß ‡∂Ω‡∂ö‡∑ä‡∑Ä‡∑ö. ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∑Ä‡∑ö‡∂ú‡∂∫ ‡∑É‡∑ú‡∂∫‡∂±‡∑ä‡∂±."
            ></textarea>
            
            <div class="hint">
                <span id="hint-text">
                    Tip: Include all given values (numbers and units) for the best results. 
                    You can type in Sinhala, English, or mix both.
                </span>
            </div>

            <button class="solve-btn" onclick="solveProblem()" id="solveBtn">
                <span class="spinner" id="spinner"></span>
                <span id="btn-text">Solve Problem</span>
            </button>
        </div>

        <!-- Results Section -->
        <div id="resultCard" class="result-card">
            <div class="result-header">
                <div class="result-title">Solution</div>
                <div class="language-tag" id="outputLangTag">English</div>
            </div>
            
            <div id="solutionContent" class="solution-content">
                <!-- AI Response will be injected here -->
            </div>

            <div class="final-answer-box" id="finalAnswerBox" style="display: none;">
                <div class="final-answer-label">Final Answer / ‡∂Ö‡∑Ä‡∑É‡∑è‡∂± ‡∂¥‡∑í‡∑Ö‡∑í‡∂≠‡∑î‡∂ª</div>
                <div class="final-answer-value" id="finalAnswerValue">--</div>
            </div>
        </div>

    </div>

    <footer>
        <p>¬© 2024 A/L Physics AI Tutor. Designed for Sri Lankan Students.</p>
        <p style="margin-top: 5px; font-size: 0.8rem;">
            Powered by AI | Runs on GitHub Pages
        </p>
    </footer>

    <script>
        // --- CONFIGURATION ---
        // ‚ö†Ô∏è REPLACE THIS WITH YOUR CLOUDFLARE WORKER URL (See instructions below)
        const API_PROXY_URL = 'https://your-worker.your-subdomain.workers.dev';
        
        let currentLang = 'en';

        // --- UI FUNCTIONS ---

        function setLang(lang) {
            currentLang = lang;
            
            // Update buttons
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${lang}`).classList.add('active');
            
            // Update labels
            const labelText = document.getElementById('label-text');
            const hintText = document.getElementById('hint-text');
            const btnText = document.getElementById('btn-text');
            
            if (lang === 'en') {
                labelText.textContent = 'Enter your Physics Problem:';
                hintText.textContent = 'Tip: Include all given values (numbers and units) for the best results. You can type in Sinhala, English, or mix both.';
                btnText.textContent = 'Solve Problem';
            } else if (lang === 'si') {
                labelText.textContent = '‡∂î‡∂∂‡∑ö ‡∂∑‡∑û‡∂≠‡∑í‡∂ö ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è ‡∂ú‡∑ê‡∂ß‡∂Ω‡∑î‡∑Ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:';
                hintText.textContent = '‡∂â‡∂ü‡∑í‡∂∫: ‡∑Ñ‡∑ú‡∂≥‡∂∏ ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂Ø‡∂≠‡∑ä‡∂≠ (‡∂Ö‡∂ú‡∂∫‡∂±‡∑ä ‡∑É‡∑Ñ ‡∂í‡∂ö‡∂ö) ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±. ‡∂î‡∂∂‡∂ß ‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω‡∑ô‡∂±‡∑ä ‡∑Ñ‡∑ù ‡∂â‡∂Ç‡∂ú‡∑ä‚Äç‡∂ª‡∑ì‡∑É‡∑í‡∂∫‡∑ô‡∂±‡∑ä ‡∂ß‡∂∫‡∑í‡∂¥‡∑ä ‡∂ö‡∑Ö ‡∑Ñ‡∑ê‡∂ö.';
                btnText.textContent = '‡∂ú‡∑ê‡∂ß‡∂Ω‡∑î‡∑Ä ‡∑Ä‡∑í‡∑É‡∂≥‡∂±‡∑ä‡∂±';
            } else {
                labelText.textContent = 'Enter your Physics Problem / ‡∂î‡∂∂‡∑ö ‡∂∑‡∑û‡∂≠‡∑í‡∂ö ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è ‡∂ú‡∑ê‡∂ß‡∂Ω‡∑î‡∑Ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±:';
                hintText.textContent = 'Include all values for best results / ‡∑Ñ‡∑ú‡∂≥‡∂∏ ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂µ‡∂Ω ‡∑É‡∂≥‡∑Ñ‡∑è ‡∑É‡∑í‡∂∫‡∂Ω‡∑î‡∂∏ ‡∂Ø‡∂≠‡∑ä‡∂≠ ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±';
                btnText.textContent = 'Solve / ‡∑Ä‡∑í‡∑É‡∂≥‡∂±‡∑ä‡∂±';
            }
        }

        async function solveProblem() {
            const question = document.getElementById('questionInput').value.trim();
            const solveBtn = document.getElementById('solveBtn');
            const spinner = document.getElementById('spinner');
            const resultCard = document.getElementById('resultCard');
            const solutionContent = document.getElementById('solutionContent');
            
            if (!question) {
                alert(currentLang === 'si' ? '‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂¥‡∑ä‚Äç‡∂ª‡∑Å‡∑ä‡∂±‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±' : 'Please enter a question');
                return;
            }

            // UI Loading State
            solveBtn.disabled = true;
            spinner.style.display = 'block';
            resultCard.style.display = 'none';

            try {
                // Prepare the prompt based on language preference
                let systemPrompt = `You are an expert A/L Physics tutor for Sri Lankan students. 
                Follow the Sri Lankan G.C.E. Advanced Level Physics syllabus (Mechanics, Waves, Electricity, Modern Physics).
                
                When solving problems:
                1. Identify the given data (convert to SI units if necessary)
                2. State the relevant physics principle/law
                3. Write the formula used
                4. Show step-by-step substitution and calculation
                5. Provide the final answer with correct units
                
                Format your response clearly with HTML tags (<h3>, <p>, <ul>, <li>, <strong>).
                Use LaTeX formatting for equations (e.g., $F = ma$) if possible, or clear text.`;

                let userPrompt = question;

                if (currentLang === 'si') {
                    systemPrompt += ` Respond entirely in Sinhala language. Use proper physics terminology in Sinhala.`;
                    userPrompt = question; // User input might be Sinhala already
                } else if (currentLang === 'both') {
                    systemPrompt += ` Provide the solution in BOTH English and Sinhala. Alternate between paragraphs or sections.`;
                } else {
                    systemPrompt += ` Respond in English.`;
                }

                // API Call to Proxy
                const response = await fetch(API_PROXY_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo", // or gpt-4 if available
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: userPrompt }
                        ],
                        temperature: 0.3 // Lower temperature for more accurate physics
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;

                // Display Result
                solutionContent.innerHTML = formatResponse(aiResponse);
                
                // Update language tag
                const langTags = { en: 'English', si: '‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω', both: 'Bilingual' };
                document.getElementById('outputLangTag').textContent = langTags[currentLang];
                
                resultCard.style.display = 'block';
                
                // Scroll to result
                resultCard.scrollIntoView({ behavior: 'smooth', block: 'start' });

            } catch (error) {
                console.error('Error:', error);
                solutionContent.innerHTML = `
                    <div class="error-box">
                        <strong>Error:</strong> Unable to connect to AI tutor.<br>
                        Please check your internet connection or try again later.<br><br>
                        <span style="font-size: 0.9rem;">
                            Note: Make sure you have set up the Cloudflare Worker proxy correctly (see instructions).
                        </span>
                    </div>
                `;
                resultCard.style.display = 'block';
            } finally {
                solveBtn.disabled = false;
                spinner.style.display = 'none';
            }
        }

        function formatResponse(text) {
            // Convert markdown-like formatting to HTML
            // Handle headers
            text = text.replace(/###\s*(.+)/g, '<h3>$1</h3>');
            text = text.replace(/##\s*(.+)/g, '<h3>$1</h3>');
            
            // Handle bold
            text = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            
            // Handle lists
            text = text.replace(/^\s*-\s*(.+)/gm, '<li>$1</li>');
            text = text.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');
            
            // Handle line breaks
            text = text.replace(/\n/g, '<br>');
            
            return text;
        }

        // Initialize
        window.onload = () => {
            // Check if proxy URL is still default
            if (API_PROXY_URL.includes('your-worker')) {
                console.warn('WARNING: Please update API_PROXY_URL with your Cloudflare Worker URL');
            }
        };
    </script>
</body>
</html>